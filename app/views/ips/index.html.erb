<% content_for :page_title, "Manage locations" %>

<div id='wrapper'>
  <div class="govuk-grid-row">
    <%= render "confirm_remove_ip" if @ip_to_delete && current_user.can_manage_locations?(current_organisation) %>
    <%= render "confirm_remove_location" if @location_to_delete && current_user.can_manage_locations?(current_organisation) %>
    <%= render "confirm_rotate_radius_key" if @key_to_rotate && current_user.can_manage_locations?(current_organisation) %>

    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">Locations</h1>
    </div>
    <div class="govuk-grid-column-one-third text-right">
      <% if current_user.can_manage_locations?(current_organisation) %>
        <%= link_to "Add a location", new_location_path, class: "govuk-button govuk-!-margin-bottom-0", role: "button", draggable: "false", "data-module" => "govuk-button" %>
      <% end %>
    </div>
  </div>

  <% if current_organisation.locations.length > 1 %>
    <div class="govuk-!-padding-bottom-7">
      <%= form_with url: ips_path, method: "get", local: true, class: "govuk-form-group" do |form| %>
        <fieldset class="govuk-fieldset">
          <legend class="govuk-fieldset__legend--m govuk-fieldset">
            Search by location or postcode
          </legend>
          <span id="search_input-hint" class="govuk-hint">For example, 'SW1A 2AA' or 'High Street'</span>
          <%= form.label :search, "Search by location or postcode", class: "govuk-label govuk-label--m govuk-visually-hidden" %>
          <%= form.text_field :search, value: params.fetch(:search, ""), class: "govuk-input govuk-input--width-10" %>
          <%= form.submit "Search", name: nil, class: "govuk-button" %>
        </fieldset>
      <% end %>
    </div>
  <% end %>

  <%== pagy_nav_govuk(@pagy) %>
  <% if current_organisation.locations.empty? %>
    <p class="govuk-body result-row-empty">
      You need to add at least one location to offer GovWifi
    </p>
  <% else %>
    <div role="status">
      <p class="govuk-body" id="no-results" style="display: none">
        <strong>No results found</strong>
      </p>
    </div>
    <div aria-live="polite">
      <% @locations.each do |location| %>
        <%= render partial: "shared/manage_ips", locals: { location: location, show_ip_controls: true } %>
      <% end %>
    </div>
  <% end %>
  <%== pagy_nav_govuk(@pagy) %>
</div>
